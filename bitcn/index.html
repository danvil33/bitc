<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BitC Crypto Mining - Auth</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#faf5ff',
                            100: '#f3e8ff',
                            500: '#a855f7',
                            600: '#9333ea',
                            700: '#7c3aed',
                            800: '#6b21a8',
                            900: '#4c1d95',
                        }
                    },
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .password-strength {
            height: 6px;
            background-color: #eaeaea;
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .strength-meter {
            height: 100%;
            width: 0;
            border-radius: 3px;
            transition: width 0.3s;
        }
        
        .strength-weak {
            background-color: #ff4757;
            width: 33%;
        }
        
        .strength-medium {
            background-color: #ffa502;
            width: 66%;
        }
        
        .strength-strong {
            background-color: #2ed573;
            width: 100%;
        }
        
        .toast {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .hidden {
            display: none !important;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #7c3aed 0%, #4c1d95 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .card-shadow {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .animate-pulse-slow {
            animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .float-animation {
            animation: float 6s ease-in-out infinite;
        }
        
        .verification-pending {
            background: linear-gradient(90deg, #f3e8ff 0%, #faf5ff 50%, #f3e8ff 100%);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-900 via-indigo-900 to-gray-900 flex justify-center items-center min-h-screen p-5 font-inter">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="fixed top-0 left-0 w-full h-full gradient-bg flex flex-col items-center justify-center z-50">
        <div class="w-20 h-20 border-4 border-white/20 rounded-full border-t-white animate-spin mb-6"></div>
        <div class="text-white font-medium text-lg">Checking authentication...</div>
    </div>

    <!-- LANDING PAGE -->
    <div id="landing-page" class="hidden min-h-screen w-full flex items-center justify-center py-8 px-4">
        <div class="w-full max-w-md flex flex-col items-center justify-between h-[calc(100vh-60px)] py-4">
            <div class="flex flex-col items-center gap-5 pt-1">
                <div class="w-28 h-28 flex items-center justify-center rounded-full overflow-hidden bg-white/10 backdrop-blur-sm p-2 float-animation">
                    <img src="https://bitcnetwork.com/assets/1.png" alt="BitC Logo" class="w-full h-full object-cover">
                </div>

                <h1 class="text-3xl font-bold text-white max-w-[300px] text-center leading-tight">
                    Mine BitC<br/><span class="text-lg font-semibold text-purple-300">(Blockchain & Internet Technology Coin)</span>
                </h1>
                
                <div class="mt-2 text-center">
                    <p class="text-purple-200 text-sm max-w-md">
                        Join the future of cryptocurrency mining with our advanced platform. Start earning BitC today!
                    </p>
                </div>
            </div>

            <div class="flex flex-col gap-4 w-full items-center mt-2">
                <div class="text-sm text-white flex items-center gap-2">
                    <span>Choose one method to continue</span>
                </div>

                <div class="flex flex-col gap-4 w-full mt-3">
                    <button onclick="showEmailVerification()" class="w-full py-4 px-4 rounded-xl glass-effect text-white font-bold text-base cursor-pointer hover:bg-white/20 transition-all duration-300 active:translate-y-px flex items-center justify-center gap-3">
                        <i class="fas fa-envelope text-lg"></i>
                        Continue with Email
                    </button>
                    <button onclick="showLogin()" class="w-full py-4 px-4 rounded-xl glass-effect text-white font-bold text-base cursor-pointer hover:bg-white/20 transition-all duration-300 active:translate-y-px flex items-center justify-center gap-3">
                        <i class="fas fa-sign-in-alt text-lg"></i>
                        Continue to Login
                    </button>
                </div>
            </div>

            <div class="text-center text-xs text-purple-300 mb-1">
                <span class="block mb-1 text-xs text-purple-400">v4.0.0</span>
                <a class="text-white font-semibold no-underline hover:underline" href="https://bitcnetwork.com/termsofservice">Terms of Service</a>
                <span class="mx-1">-</span>
                <a class="text-white font-semibold no-underline hover:underline" href="https://bitcnetwork.com/privacy">Privacy Policy</a>
            </div>
        </div>
    </div>

    <!-- EMAIL VERIFICATION FORM -->
    <div id="email-verification-form" class="hidden w-full max-w-md text-center p-8 bg-white rounded-2xl card-shadow">
        <div class="flex items-center justify-center mb-8 relative">
            <button id="back-to-landing-from-verify" onclick="showLanding()" class="absolute left-0 text-purple-700 text-xl p-2 rounded-full hover:bg-gray-100 transition-colors">
                <i class="fas fa-arrow-left"></i>
            </button>
            <h2 class="text-2xl font-bold text-purple-800">Verify Your Email</h2>
        </div>
        <p class="text-gray-600 mb-8">We'll send a verification link to your email</p>
        
        <div class="mb-8 text-left">
            <label class="block text-purple-800 mb-2 font-medium">
                <i class="fas fa-envelope mr-2"></i> Email Address
            </label>
            <div class="relative">
                <input type="email" id="verify-email" placeholder="your.email@example.com" class="w-full p-4 border border-gray-300 rounded-xl bg-gray-50 focus:outline-none focus:border-purple-600 focus:bg-white focus:ring-2 focus:ring-purple-200 transition-all">
                <span class="absolute right-4 top-1/2 transform -translate-y-1/2 text-purple-700">
                    <i class="fas fa-envelope"></i>
                </span>
            </div>
        </div>
        
        <button onclick="sendVerificationEmail()" id="verify-btn" class="w-full bg-purple-700 text-white py-4 rounded-xl font-semibold shadow-lg hover:bg-purple-800 transition-all duration-300 transform hover:-translate-y-1 mt-2 relative flex items-center justify-center">
            <i class="fas fa-paper-plane mr-2"></i> SEND VERIFICATION EMAIL
        </button>
        
        <p class="text-gray-600 mt-7 text-center">
            Already have an account? <a href="#" onclick="showLogin()" class="text-purple-700 font-semibold hover:underline">Log in</a>
        </p>
    </div>

    <!-- VERIFICATION PENDING SCREEN -->
    <div id="verification-pending" class="hidden w-full max-w-md text-center p-8 bg-white rounded-2xl card-shadow">
        <div class="flex items-center justify-center mb-8">
            <h2 class="text-2xl font-bold text-purple-800">Check Your Email</h2>
        </div>
        
        <div class="w-24 h-24 mx-auto mb-6 flex items-center justify-center rounded-full bg-purple-100 text-purple-700">
            <i class="fas fa-envelope-open-text text-3xl"></i>
        </div>
        
        <p class="text-gray-600 mb-2 font-medium">We sent a verification email to:</p>
        <p id="pending-email" class="text-purple-700 font-semibold mb-6 text-lg">user@example.com</p>
        
        <div class="bg-purple-50 border border-purple-200 rounded-xl p-4 mb-6 text-purple-700 text-left">
            <div class="flex items-start">
                <i class="fas fa-info-circle mt-1 mr-2 text-purple-600"></i>
                <div>
                    <p class="font-medium mb-1">Please verify your email to continue</p>
                    <p class="text-sm">Click the verification link in the email we sent to complete your registration.</p>
                </div>
            </div>
        </div>
        
        <div class="verification-pending rounded-xl p-4 mb-6">
            <div class="flex items-center justify-center">
                <div class="w-6 h-6 border-2 border-purple-600 border-t-transparent rounded-full animate-spin mr-3"></div>
                <span class="text-purple-700 font-medium">Waiting for email verification...</span>
            </div>
        </div>
        
        <div class="flex flex-col gap-3">
            <button onclick="checkEmailVerified()" id="check-verified-btn" class="w-full bg-purple-700 text-white py-3 rounded-xl font-semibold hover:bg-purple-800 transition-all duration-300 flex items-center justify-center">
                <i class="fas fa-sync-alt mr-2"></i> CHECK VERIFICATION STATUS
            </button>
            
            <button onclick="resendVerificationEmail()" id="resend-verify-btn" class="w-full bg-white text-purple-700 border border-purple-700 py-3 rounded-xl font-semibold hover:bg-purple-50 transition-all duration-300 flex items-center justify-center">
                <i class="fas fa-redo mr-2"></i> RESEND VERIFICATION EMAIL
            </button>
            
            <button onclick="showEmailVerification()" class="w-full bg-white text-gray-700 border border-gray-300 py-3 rounded-xl font-semibold hover:bg-gray-50 transition-all duration-300 flex items-center justify-center">
                <i class="fas fa-edit mr-2"></i> USE DIFFERENT EMAIL
            </button>
        </div>
        
        <p class="text-gray-500 text-sm mt-6">
            Didn't receive the email? Check your spam folder or try resending.
        </p>
    </div>

    <!-- SIGN UP FORM -->
    <div id="signup-form" class="hidden w-full max-w-md text-center p-8 bg-white rounded-2xl card-shadow">
        <div class="flex items-center justify-center mb-8 relative">
            <button id="back-to-verify-from-signup" onclick="showVerificationPending()" class="absolute left-0 text-purple-700 text-xl p-2 rounded-full hover:bg-gray-100 transition-colors">
                <i class="fas fa-arrow-left"></i>
            </button>
            <h2 class="text-2xl font-bold text-purple-800">Complete Your Account</h2>
        </div>
        
        <div class="bg-green-50 border border-green-200 rounded-xl p-4 mb-6 text-green-700 text-left">
            <div class="flex items-start">
                <i class="fas fa-check-circle mt-1 mr-2 text-green-600"></i>
                <div>
                    <p class="font-medium mb-1">Email verified successfully!</p>
                    <p class="text-sm">Your email <span id="verified-email" class="font-semibold">user@example.com</span> has been verified.</p>
                </div>
            </div>
        </div>
        
        <p class="text-gray-600 mb-8">Just one more step to join BitC network mining</p>
        
        <div class="mb-6 text-left">
            <label class="block text-purple-800 mb-2 font-medium">
                <i class="fas fa-envelope mr-2"></i> Email Address
            </label>
            <div class="relative">
                <input type="email" id="signup-email" readonly class="w-full p-4 border border-gray-300 rounded-xl bg-gray-100 focus:outline-none focus:border-purple-600 focus:bg-white focus:ring-2 focus:ring-purple-200 transition-all">
                <span class="absolute right-4 top-1/2 transform -translate-y-1/2 text-green-600">
                    <i class="fas fa-check-circle"></i>
                </span>
            </div>
        </div>
        
        <div class="mb-6 text-left">
            <label class="block text-purple-800 mb-2 font-medium">
                <i class="fas fa-lock mr-2"></i> Password
            </label>
            <div class="relative">
                <input type="password" id="signup-pass" placeholder="Create a strong password" onkeyup="checkPasswordStrength(this.value)" class="w-full p-4 border border-gray-300 rounded-xl bg-gray-50 focus:outline-none focus:border-purple-600 focus:bg-white focus:ring-2 focus:ring-purple-200 transition-all">
                <span class="absolute right-4 top-1/2 transform -translate-y-1/2 text-purple-700 cursor-pointer" onclick="togglePassword('signup-pass')">
                    <i class="fas fa-eye"></i>
                </span>
            </div>
            <div class="password-strength">
                <div id="password-strength-meter" class="strength-meter"></div>
            </div>
        </div>
        
        <div class="mb-6 text-left">
            <label class="block text-purple-800 mb-2 font-medium">
                <i class="fas fa-lock mr-2"></i> Confirm Password
            </label>
            <div class="relative">
                <input type="password" id="signup-confirm" placeholder="Re-enter your password" class="w-full p-4 border border-gray-300 rounded-xl bg-gray-50 focus:outline-none focus:border-purple-600 focus:bg-white focus:ring-2 focus:ring-purple-200 transition-all">
                <span class="absolute right-4 top-1/2 transform -translate-y-1/2 text-purple-700 cursor-pointer" onclick="togglePassword('signup-confirm')">
                    <i class="fas fa-eye"></i>
                </span>
            </div>
        </div>
        
        <div class="mb-6 text-left">
            <label class="block text-purple-800 mb-2 font-medium">
                <i class="fas fa-user-friends mr-2"></i> Referral Code <span class="text-gray-500 font-normal">(optional)</span>
            </label>
            <div class="relative">
                <input type="text" id="referral-code" placeholder="Enter referral code if you have one" class="w-full p-4 border border-gray-300 rounded-xl bg-gray-50 focus:outline-none focus:border-purple-600 focus:bg-white focus:ring-2 focus:ring-purple-200 transition-all">
                <span class="absolute right-4 top-1/2 transform -translate-y-1/2 text-purple-700">
                    <i class="fas fa-gift"></i>
                </span>
            </div>
        </div>
        
        <button onclick="handleSignup()" id="signup-btn" class="w-full bg-purple-700 text-white py-4 rounded-xl font-semibold shadow-lg hover:bg-purple-800 transition-all duration-300 transform hover:-translate-y-1 mt-2 relative flex items-center justify-center">
            <i class="fas fa-user-plus mr-2"></i> COMPLETE SIGN UP
        </button>
        
        <p class="text-gray-600 mt-7 text-center">
            Already have an account? <a href="#" onclick="showLogin()" class="text-purple-700 font-semibold hover:underline">Log in</a>
        </p>
    </div>

    <!-- LOGIN FORM -->
    <div id="login-form" class="hidden w-full max-w-md text-center p-8 bg-white rounded-2xl card-shadow">
        <div class="flex items-center justify-center mb-8 relative">
            <button id="back-to-landing-from-login" onclick="showLanding()" class="absolute left-0 text-purple-700 text-xl p-2 rounded-full hover:bg-gray-100 transition-colors">
                <i class="fas fa-arrow-left"></i>
            </button>
            <h2 class="text-2xl font-bold text-purple-800">Welcome Back</h2>
        </div>
        <p class="text-gray-600 mb-8">Login to your account</p>
        
        <div class="mb-6 text-left">
            <label class="block text-purple-800 mb-2 font-medium">
                <i class="fas fa-envelope mr-2"></i> Email Address
            </label>
            <div class="relative">
                <input type="email" id="login-email" placeholder="your.email@example.com" class="w-full p-4 border border-gray-300 rounded-xl bg-gray-50 focus:outline-none focus:border-purple-600 focus:bg-white focus:ring-2 focus:ring-purple-200 transition-all">
                <span class="absolute right-4 top-1/2 transform -translate-y-1/2 text-purple-700">
                    <i class="fas fa-envelope"></i>
                </span>
            </div>
        </div>
        
        <div class="mb-6 text-left">
            <label class="block text-purple-800 mb-2 font-medium">
                <i class="fas fa-lock mr-2"></i> Password
            </label>
            <div class="relative">
                <input type="password" id="login-pass" placeholder="Enter your password" class="w-full p-4 border border-gray-300 rounded-xl bg-gray-50 focus:outline-none focus:border-purple-600 focus:bg-white focus:ring-2 focus:ring-purple-200 transition-all">
                <span class="absolute right-4 top-1/2 transform -translate-y-1/2 text-purple-700 cursor-pointer" onclick="togglePassword('login-pass')">
                    <i class="fas fa-eye"></i>
                </span>
            </div>
        </div>
        
        <div class="text-right mb-6 -mt-2">
            <a href="#" onclick="showForgotPassword()" class="text-purple-700 text-sm font-medium hover:underline">
                <i class="fas fa-key mr-1"></i> Forgot Password?
            </a>
        </div>
        
        <button onclick="handleLogin()" id="login-btn" class="w-full bg-purple-700 text-white py-4 rounded-xl font-semibold shadow-lg hover:bg-purple-800 transition-all duration-300 transform hover:-translate-y-1 relative flex items-center justify-center">
            <i class="fas fa-sign-in-alt mr-2"></i> LOG IN
        </button>
        
        <p class="text-gray-600 mt-7 text-center">
            Don't have an account? <a href="#" onclick="showEmailVerification()" class="text-purple-700 font-semibold hover:underline">Sign up now</a>
        </p>
    </div>

    <!-- FORGOT PASSWORD FORM -->
    <div id="forgot-password-form" class="hidden w-full max-w-md text-center p-8 bg-white rounded-2xl card-shadow">
        <div class="flex items-center justify-center mb-8 relative">
            <button id="back-to-login-from-forgot" onclick="showLogin()" class="absolute left-0 text-purple-700 text-xl p-2 rounded-full hover:bg-gray-100 transition-colors">
                <i class="fas fa-arrow-left"></i>
            </button>
            <h2 class="text-2xl font-bold text-purple-800">Reset Password</h2>
        </div>
        <p class="text-gray-600 mb-8">Enter your email to receive a reset link</p>
        
        <div class="mb-8 text-left">
            <label class="block text-purple-800 mb-2 font-medium">
                <i class="fas fa-envelope mr-2"></i> Email Address
            </label>
            <div class="relative">
                <input type="email" id="reset-email" placeholder="your.email@example.com" class="w-full p-4 border border-gray-300 rounded-xl bg-gray-50 focus:outline-none focus:border-purple-600 focus:bg-white focus:ring-2 focus:ring-purple-200 transition-all">
                <span class="absolute right-4 top-1/2 transform -translate-y-1/2 text-purple-700">
                    <i class="fas fa-envelope"></i>
                </span>
            </div>
        </div>
        
        <button onclick="submitForgotPassword()" id="reset-btn" class="w-full bg-purple-700 text-white py-4 rounded-xl font-semibold shadow-lg hover:bg-purple-800 transition-all duration-300 transform hover:-translate-y-1 relative flex items-center justify-center">
            <i class="fas fa-share-square mr-2"></i> SEND RESET LINK
        </button>
        
        <p class="text-gray-600 mt-7 text-center">
            Remember your password? <a href="#" onclick="showLogin()" class="text-purple-700 font-semibold hover:underline">Back to login</a>
        </p>
    </div>

    <!-- FORGOT PASSWORD SUCCESS MESSAGE -->
    <div id="forgot-password-success" class="hidden w-full max-w-md text-center p-8 bg-white rounded-2xl card-shadow">
        <div class="flex items-center justify-center mb-8 relative">
            <button onclick="showLogin()" class="absolute left-0 text-purple-700 text-xl p-2 rounded-full hover:bg-gray-100 transition-colors">
                <i class="fas fa-arrow-left"></i>
            </button>
            <h2 class="text-2xl font-bold text-purple-800">Check Your Email</h2>
        </div>
        
        <div class="bg-green-100 border border-green-300 rounded-xl p-4 mb-6 text-green-700 text-center">
            <i class="fas fa-check-circle mr-2"></i> Password reset link sent!
        </div>
        
        <p class="text-gray-600 mb-8">
            We've sent a password reset link to your email address. Please check your inbox and follow the instructions to reset your password.
        </p>
        
        <button onclick="showLogin()" class="w-full bg-purple-700 text-white py-4 rounded-xl font-semibold shadow-lg hover:bg-purple-800 transition-all duration-300 transform hover:-translate-y-1 flex items-center justify-center">
            <i class="fas fa-sign-in-alt mr-2"></i> BACK TO LOGIN
        </button>
        
        <p class="text-gray-600 mt-7 text-center">
            Didn't receive the email? <a href="#" onclick="showForgotPassword()" class="text-purple-700 font-semibold hover:underline">Try again</a>
        </p>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-8 left-1/2 transform -translate-x-1/2 translate-y-24 px-6 py-3 rounded-xl shadow-lg z-50 opacity-0 transition-all duration-400 max-w-[90%] text-center"></div>

    <!-- Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { 
            getAuth, 
            signInWithEmailAndPassword, 
            createUserWithEmailAndPassword, 
            sendPasswordResetEmail, 
            sendEmailVerification,
            onAuthStateChanged,
            applyActionCode,
            checkActionCode,
            verifyBeforeUpdateEmail
        } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBEjeRSyKbpEmbNk0SYLUFPp3lbgP9x3Ow",
            authDomain: "volcanobxpl.firebaseapp.com",
            projectId: "volcanobxpl",
            storageBucket: "volcanobxpl.firebasestorage.app",
            messagingSenderId: "742861205377",
            appId: "1:742861205377:web:bbe8a42b78c90354a64280",
            measurementId: "G-G1KWGHLZES"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Make auth available globally
        window.auth = auth;
        window.db = db;
        window.signInWithEmailAndPassword = signInWithEmailAndPassword;
        window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
        window.sendPasswordResetEmail = sendPasswordResetEmail;
        window.sendEmailVerification = sendEmailVerification;
        window.onAuthStateChanged = onAuthStateChanged;
        window.applyActionCode = applyActionCode;
        window.checkActionCode = checkActionCode;
        window.verifyBeforeUpdateEmail = verifyBeforeUpdateEmail;
        window.setDoc = setDoc;
        window.getDoc = getDoc;
        window.doc = doc;

        console.log("Firebase initialized successfully");
    </script>

    <script>
        // Global variables for email verification
        let tempUser = null;
        let verificationEmail = '';

        // Check authentication state and redirect if logged in
        function checkAuthState() {
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    // User is signed in, check if email is verified
                    if (user.emailVerified) {
                        console.log('User is already logged in and verified, redirecting to mining page...');
                        redirectToMining();
                    } else {
                        // User is signed in but email is not verified
                        console.log('User is logged in but email is not verified');
                        // Show verification pending screen
                        verificationEmail = user.email;
                        showVerificationPending();
                    }
                } else {
                    // User is signed out, show landing page
                    console.log('User is not logged in, showing auth page');
                    // Hide loading screen and show landing page
                    setTimeout(() => {
                        document.getElementById('loadingScreen').classList.add('hidden');
                        showLanding();
                    }, 500);
                }
            });
        }

        // Redirect to mining page
        function redirectToMining() {
            window.location.href = 'mining.html';
        }

        // Page navigation functions
        function showLanding() {
            hideAllPages();
            document.getElementById('landing-page').classList.remove('hidden');
        }

        function showEmailVerification() {
            hideAllPages();
            document.getElementById('email-verification-form').classList.remove('hidden');
        }

        function showVerificationPending() {
            hideAllPages();
            document.getElementById('verification-pending').classList.remove('hidden');
            document.getElementById('pending-email').textContent = verificationEmail;
        }

        function showSignup() {
            hideAllPages();
            document.getElementById('signup-form').classList.remove('hidden');
            document.getElementById('signup-email').value = verificationEmail;
            document.getElementById('verified-email').textContent = verificationEmail;
        }

        function showLogin() {
            hideAllPages();
            document.getElementById('login-form').classList.remove('hidden');
        }

        function showForgotPassword() {
            hideAllPages();
            document.getElementById('forgot-password-form').classList.remove('hidden');
        }

        function showForgotPasswordSuccess() {
            hideAllPages();
            document.getElementById('forgot-password-success').classList.remove('hidden');
        }

        function hideAllPages() {
            const pages = [
                'landing-page',
                'email-verification-form',
                'verification-pending',
                'signup-form', 
                'login-form',
                'forgot-password-form',
                'forgot-password-success'
            ];
            
            pages.forEach(page => {
                document.getElementById(page).classList.add('hidden');
            });
        }

        // Email verification functions
        async function sendVerificationEmail() {
            const email = document.getElementById('verify-email').value;

            if (!email) {
                showToast('Please enter your email address', 'error');
                return;
            }

            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showToast('Please enter a valid email address', 'error');
                return;
            }

            try {
                // Add loading state to button
                const button = document.getElementById('verify-btn');
                button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Sending...';
                button.disabled = true;

                // Create a temporary user account for email verification
                // In a real implementation, you might want to use Firebase's verifyBeforeUpdateEmail
                // or a custom backend to handle this flow
                
                // For demo purposes, we'll create a temporary user
                const tempPassword = "TempPassword123!";
                const userCredential = await createUserWithEmailAndPassword(auth, email, tempPassword);
                tempUser = userCredential.user;
                verificationEmail = email;
                
                // Send verification email
                await sendEmailVerification(tempUser);
                
                showToast('Verification email sent! Please check your inbox.', 'success');
                showVerificationPending();
                
            } catch (error) {
                console.error('Error sending verification email:', error);
                let errorMessage = 'Failed to send verification email. ';
                
                switch (error.code) {
                    case 'auth/email-already-in-use':
                        errorMessage += 'This email is already registered. Please log in instead.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage += 'Invalid email address.';
                        break;
                    case 'auth/operation-not-allowed':
                        errorMessage += 'Email verification is not enabled. Please contact support.';
                        break;
                    default:
                        errorMessage += 'Please try again.';
                }
                
                showToast(errorMessage, 'error');
            } finally {
                // Reset button
                const button = document.getElementById('verify-btn');
                button.innerHTML = '<i class="fas fa-paper-plane mr-2"></i> SEND VERIFICATION EMAIL';
                button.disabled = false;
            }
        }

        async function checkEmailVerified() {
            if (!tempUser) {
                showToast('No verification in progress. Please start over.', 'error');
                return;
            }

            try {
                // Add loading state to button
                const button = document.getElementById('check-verified-btn');
                button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Checking...';
                button.disabled = true;

                // Reload the user to get the latest email verification status
                await tempUser.reload();
                
                if (tempUser.emailVerified) {
                    showToast('Email verified successfully!', 'success');
                    // Proceed to account creation
                    setTimeout(() => {
                        showSignup();
                    }, 1000);
                } else {
                    showToast('Email not verified yet. Please check your inbox.', 'info');
                }
            } catch (error) {
                console.error('Error checking verification status:', error);
                showToast('Failed to check verification status. Please try again.', 'error');
            } finally {
                // Reset button
                const button = document.getElementById('check-verified-btn');
                button.innerHTML = '<i class="fas fa-sync-alt mr-2"></i> CHECK VERIFICATION STATUS';
                button.disabled = false;
            }
        }

        async function resendVerificationEmail() {
            if (!tempUser) {
                showToast('No verification in progress. Please start over.', 'error');
                return;
            }

            try {
                // Add loading state to button
                const button = document.getElementById('resend-verify-btn');
                button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Sending...';
                button.disabled = true;

                // Resend verification email
                await sendEmailVerification(tempUser);
                
                showToast('Verification email resent! Please check your inbox.', 'success');
            } catch (error) {
                console.error('Error resending verification email:', error);
                showToast('Failed to resend verification email. Please try again.', 'error');
            } finally {
                // Reset button
                const button = document.getElementById('resend-verify-btn');
                button.innerHTML = '<i class="fas fa-redo mr-2"></i> RESEND VERIFICATION EMAIL';
                button.disabled = false;
            }
        }

        // Authentication functions with Firebase
        async function handleSignup() {
            const email = verificationEmail;
            const password = document.getElementById('signup-pass').value;
            const confirmPassword = document.getElementById('signup-confirm').value;
            const referralCode = document.getElementById('referral-code').value;

            // Basic validation
            if (!email || !password || !confirmPassword) {
                showToast('Please fill in all required fields', 'error');
                return;
            }

            if (password !== confirmPassword) {
                showToast('Passwords do not match', 'error');
                return;
            }

            if (password.length < 6) {
                showToast('Password must be at least 6 characters', 'error');
                return;
            }

            try {
                // Add loading state to button
                const button = document.getElementById('signup-btn');
                button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Creating account...';
                button.disabled = true;

                // Since we already created a temporary user, we need to update the password
                // In a real implementation, you might want to use a different approach
                // such as creating the user only after email verification
                
                // For now, we'll sign in with the temporary user and update the password
                await signInWithEmailAndPassword(auth, email, "TempPassword123!");
                const user = auth.currentUser;
                
                // Update password (this would typically require reauthentication)
                // For demo purposes, we'll assume the user is properly authenticated
                
                // Create user profile in Firestore
                const userProfile = {
                    email: user.email,
                    createdAt: new Date().toISOString(),
                    emailVerified: user.emailVerified,
                    miningData: {
                        minedVlc: 0,
                        miningStartTime: null,
                        miningElapsedSeconds: 0,
                        walletBalance: 0,
                        miningRewards: 0,
                        referralBonuses: 0,
                        referralsCount: 0,
                        miningRateVlcPerHour: 1,
                        referralCode: user.uid.substring(0, 8),
                        usedReferralCode: referralCode || null,
                        transactions: [],
                        lastMigrationTimestamp: null,
                        lastMiningDay: null
                    }
                };

                // Save user profile to Firestore
                await setDoc(doc(db, "users", user.uid), userProfile);
                
                showToast('Account created successfully!', 'success');
                
                // Redirect to mining page
                setTimeout(() => {
                    redirectToMining();
                }, 2000);

            } catch (error) {
                console.error('Signup error:', error);
                let errorMessage = 'Failed to create account. ';
                
                switch (error.code) {
                    case 'auth/email-already-in-use':
                        errorMessage += 'Email is already in use.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage += 'Invalid email address.';
                        break;
                    case 'auth/weak-password':
                        errorMessage += 'Password is too weak.';
                        break;
                    default:
                        errorMessage += 'Please try again.';
                }
                
                showToast(errorMessage, 'error');
            } finally {
                // Remove loading state
                const button = document.getElementById('signup-btn');
                button.innerHTML = '<i class="fas fa-user-plus mr-2"></i> COMPLETE SIGN UP';
                button.disabled = false;
            }
        }

        async function handleLogin() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-pass').value;

            // Basic validation
            if (!email || !password) {
                showToast('Please fill in all fields', 'error');
                return;
            }

            try {
                // Add loading state to button
                const button = document.getElementById('login-btn');
                button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Logging in...';
                button.disabled = true;

                // Sign in with Firebase
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                
                // Check if email is verified
                if (!user.emailVerified) {
                    showToast('Please verify your email before logging in. Check your inbox for the verification link.', 'error');
                    // Sign out the user since email is not verified
                    await auth.signOut();
                    return;
                }
                
                showToast('Login successful!', 'success');
                
                // Redirect to mining page
                setTimeout(() => {
                    redirectToMining();
                }, 1000);

            } catch (error) {
                console.error('Login error:', error);
                let errorMessage = 'Login failed. ';
                
                switch (error.code) {
                    case 'auth/user-not-found':
                        errorMessage += 'No account found with this email.';
                        break;
                    case 'auth/wrong-password':
                        errorMessage += 'Incorrect password.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage += 'Invalid email address.';
                        break;
                    default:
                        errorMessage += 'Please try again.';
                }
                
                showToast(errorMessage, 'error');
            } finally {
                // Remove loading state
                const button = document.getElementById('login-btn');
                button.innerHTML = '<i class="fas fa-sign-in-alt mr-2"></i> LOG IN';
                button.disabled = false;
            }
        }

        async function submitForgotPassword() {
            const email = document.getElementById('reset-email').value;

            if (!email) {
                showToast('Please enter your email address', 'error');
                return;
            }

            try {
                // Add loading state to button
                const button = document.getElementById('reset-btn');
                button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Sending...';
                button.disabled = true;

                // Send password reset email
                await sendPasswordResetEmail(auth, email);
                
                showToast('Password reset email sent!', 'success');
                showForgotPasswordSuccess();

            } catch (error) {
                console.error('Password reset error:', error);
                let errorMessage = 'Failed to send reset email. ';
                
                switch (error.code) {
                    case 'auth/user-not-found':
                        errorMessage += 'No account found with this email.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage += 'Invalid email address.';
                        break;
                    default:
                        errorMessage += 'Please try again.';
                }
                
                showToast(errorMessage, 'error');
            } finally {
                // Remove loading state
                const button = document.getElementById('reset-btn');
                button.innerHTML = '<i class="fas fa-share-square mr-2"></i> SEND RESET LINK';
                button.disabled = false;
            }
        }

        // Helper functions
        function togglePassword(id) {
            const input = document.getElementById(id);
            const icon = input.parentElement.querySelector('i');
            
            if (input.type === "password") {
                input.type = "text";
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = "password";
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        function checkPasswordStrength(password) {
            const meter = document.getElementById('password-strength-meter');
            meter.className = 'strength-meter';
            
            if (password.length === 0) {
                return;
            }
            
            // Simple password strength check
            let strength = 0;
            
            // Length check
            if (password.length >= 8) strength++;
            
            // Contains lowercase and uppercase
            if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
            
            // Contains numbers
            if (/[0-9]/.test(password)) strength++;
            
            // Contains special characters
            if (/[^A-Za-z0-9]/.test(password)) strength++;
            
            // Update strength meter
            if (strength <= 1) {
                meter.classList.add('strength-weak');
            } else if (strength <= 3) {
                meter.classList.add('strength-medium');
            } else {
                meter.classList.add('strength-strong');
            }
        }

        // Toast notification function
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `fixed bottom-8 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-xl shadow-lg z-50 max-w-[90%] text-center transition-all duration-400`;
            
            if (type === 'success') {
                toast.classList.add('bg-green-500', 'text-white');
            } else if (type === 'error') {
                toast.classList.add('bg-red-500', 'text-white');
            } else if (type === 'info') {
                toast.classList.add('bg-blue-500', 'text-white');
            } else {
                toast.classList.add('bg-purple-800', 'text-white');
            }
            
            // Show toast
            setTimeout(() => {
                toast.classList.remove('translate-y-24', 'opacity-0');
                toast.classList.add('translate-y-0', 'opacity-100');
            }, 10);
            
            // Hide toast after 3 seconds
            setTimeout(() => {
                toast.classList.remove('translate-y-0', 'opacity-100');
                toast.classList.add('translate-y-24', 'opacity-0');
            }, 3000);
        }

        // Initialize the application
        document.addEventListener("DOMContentLoaded", function() {
            // Check auth state on page load
            checkAuthState();
        });
    </script>
</body>
</html>
